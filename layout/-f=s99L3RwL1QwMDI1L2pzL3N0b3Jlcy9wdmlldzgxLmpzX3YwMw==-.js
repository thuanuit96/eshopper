$(function(){$('#listImgZoom_2').carouFredSel({width:339,items:4,direction:"left",scroll:{items:1,duration:500,onAfter:function(data){data.items.visible.first().find('img').addClass('cloudzoom-gallery-active');}},auto:false,prev:"#prevSlideZ",next:"#nextSlideZ"});$('p.color a.cloudzoom-gallery').click(function(){var src=$(this).attr('data-src');$('#listImgZoom_2').trigger('slideTo','[data-src$="'+src+'"]');});checkInv();$('.detailComb').click(function(e){e.preventDefault();$(this).parents('.attrCbo').addClass('itme');$.post('/product/q'+$(this).attr('id')+'?temp=quickviewcombo',function(rs){$.fancybox({content:rs,padding:[20,55,20,55],fitToView:false,wrapCSS:'fancybox-qv',closeBtn:false,modal:true,helpers:{overlay:{css:{'background':'rgba(158, 158, 158, 0.5)'}}},afterShow:function(){$('div#quickView .sl ul').carouFredSel({items:1,scroll:{items:1,duration:400},auto:false,prev:"#prevQv",next:"#nextQv"});$.getScript('qviewCombo.js'/*tpa=http://bosua.vn/tp/c0004/js/qviewCombo.js*/);}});});});$('#buyCombo').click(function(){var buy=$(this);if(buy.attr('ck')==1){var products=[];$('.attrCbo').each(function(){var t=$(this),ps={};ps['id']=t.attr('id');ps['quantity']=t.attr('qtt');ps['comboId']=buy.attr('cbid');products.push(ps);});addToCart(products,1,function(rs){if(rs.status==1){window.location.href='cart.htm'/*tpa=http://bosua.vn/cart*/}else{var mes=$('#dialogMessage');mes.html('<p><span class="ui-icon ui-icon-alert" style="float: left; margin: 0 10px 40px 0;"></span>'+
rs.messages+'</p>');mes.dialog({title:"Thông báo!",modal:true,show:"explode",hide:"explode",buttons:{Ok:function(){$(this).dialog("close");}}});}});}});$('.req a').tooltip({position:{my:"center bottom-10",at:"center top",using:function(position,feedback){$(this).css(position);$("<div>").addClass("arrow").addClass(feedback.vertical).addClass(feedback.horizontal).appendTo(this);}}});$('.btn').tooltip({position:{my:"center bottom-10",at:"center top",using:function(position,feedback){$(this).css(position);$("<div>").addClass("arrow").addClass(feedback.vertical).addClass(feedback.horizontal).appendTo(this);}}});$('#sizeTb').fancybox({href:'#dialogContent',fitToView:false,width:'auto',height:'auto'});CloudZoom.quickStart();$('#z').bind('click',function(){var cloudZoom=$(this).data('CloudZoom');$.fancybox.open(cloudZoom.getGalleryList(),{padding:0});return false;});$('#psQttDown').click(function(){var qtt=$('#psQtt'),m=parseInt(qtt.attr('max')),v=parseInt(qtt.attr('val'));if(v>1){qtt.attr('val',v-1);qtt.html(v-1);}});$('#psQttUp').click(function(){var qtt=$('#psQtt'),m=parseInt(qtt.attr('max')),v=parseInt(qtt.attr('val'));if(v<m){qtt.attr('val',v+1);qtt.html(v+1);}});$('.policy').click(function(){if(!$(this).hasClass('active')){$('.policy>p').slideUp();$('.policy').removeClass('active');$('.policy i').removeClass('fa-caret-down').addClass('fa-caret-right');}
$(this).find('p').slideDown();$(this).find('i').removeClass('fa-caret-right').addClass('fa-caret-down');$(this).addClass('active');});$('#addToCart').click(function(){var t=$(this);if(t.attr('ck')==1){var products=[],ps={};ps['id']=t.attr('selId');ps['quantity']=$('#psQtt').attr('val');products.push(ps);addToCart(products,1,function(rs){if(rs.status==1){window.location.href='cart.htm'/*tpa=http://bosua.vn/cart*/}else{var mes=$('#dialogMessage');mes.html('<p><span class="ui-icon ui-icon-alert" style="float: left; margin: 0 10px 40px 0;"></span>'+
rs.messages+'</p>');mes.dialog({title:"Thông báo!",modal:true,show:"explode",hide:"explode",buttons:{Ok:function(){$(this).dialog("close");}}});}});}});$('.size a').click(function(){var t=$(this),size=$('.size a'),qtt=$('#psQtt'),atc=$('#addToCart');var attrs={};if(!t.hasClass('active')){size.removeClass('active');atc.attr('title','Vui lòng chọn màu sắc hoặc kích cỡ!').attr('ck',0).addClass('unsel');attrs[$('.size').attr('column')]=t.attr('value');if($('.color').length&&!$('.color a.active').length){size.attr('title','Vui lòng chọn màu sắc trước!');}else{if(t.attr('qtt')){if(t.attr('data-discount')>0){$('.price > p').html($.number(t.attr('data-price')-t.attr('data-discount'))+' VNĐ');$('.price > p').append('<s style="font-size:'+' 20px;color:#ccc;font-weight:normal;padding-left: 5px;">'+$.number(t.attr('data-price'))+' VNĐ</s>');}else{$('.price > p>span').html($.number(t.attr('data-price'))+' VNĐ');}
t.addClass('active');qtt.attr('max',t.attr('qtt'));atc.attr('selId',t.attr('selId')).removeAttr('title').attr('ck',1).removeClass('unsel');}}}});$('.color a').click(function(){var t=$(this),size=$('.size a'),qtt=$('#psQtt'),atc=$('#addToCart'),attrs={};if(!t.hasClass('active')){$('.color a').removeClass('active');atc.attr('title','Vui lòng chọn màu sắc hoặc kích cỡ!').attr('ck',0).addClass('unsel');if(size.length>1){size.removeClass('active deactive');t.addClass('active');size.removeAttr('title');attrs[$('.color').attr('column')]=t.attr('value');size.each(function(){var t=$(this);attrs[$('.size').attr('column')]=t.attr('value');$.post('/product/child?psId='+$('#addToCart').attr('psid'),{'attrs':attrs},function(rs){if(rs.code==1){t.attr('qtt',rs.data.available).attr('selId',rs.data.id).attr('data-price',rs.data.price);}else{t.addClass('deactive').attr('title','Sản phẩm tạm thời hết hàng!').removeAttr('qtt');}},'json');});}else{if(t.attr('qtt')){t.addClass('active');atc.attr('selId',t.attr('selId')).removeAttr('title').attr('ck',1).removeClass('unsel');qtt.attr('max',t.attr('qtt'));}}}});});function checkInv(){var req=$('.req').length,attrs={},atc=$('#addToCart'),qtt=$('#psQtt');if(req==1){if($('.color').length){if($('.color a.active').length){attrs[$('.color').attr('column')]=$('.color a.active').attr('value');$.post('/product/child?psId='+atc.attr('psid'),{'attrs':attrs},function(rs){if(rs.code==1){qtt.attr('max',rs.data.available);atc.attr('selId',rs.data.id).removeAttr('title').attr('ck',1).removeClass('unsel');}else{atc.attr('title','Sản phẩm tạm thời hết hàng!');}},'json');}else{$('.color a').each(function(){var t=$(this);attrs[$('.color').attr('column')]=t.attr('value');$.post('/product/child?psId='+atc.attr('psid'),{'attrs':attrs},function(rs){if(rs.code==1){t.attr('qtt',rs.data.available).attr('selId',rs.data.id);}else{t.addClass('deactive').attr('title','Sản phẩm tạm thời hết hàng!');}},'json');});}}else{if($('.size a.active').length){attrs[$('.size').attr('column')]=$('.size a.active').attr('value');$.post('/product/child?psId='+atc.attr('psid'),{'attrs':attrs},function(rs){if(rs.code==1){qtt.attr('max',rs.data.available);atc.attr('selId',rs.data.id).removeAttr('title').attr('ck',1).removeClass('unsel');}else{atc.attr('title','Sản phẩm tạm thời hết hàng!');}},'json');}else{$('.size a').each(function(){var t=$(this);attrs[$('.size').attr('column')]=t.attr('value');$.post('/product/child?psId='+atc.attr('psid'),{'attrs':attrs},function(rs){if(rs.code==1){t.attr('qtt',rs.data.available).attr('selId',rs.data.id);}else{t.addClass('deactive').attr('title','Sản phẩm tạm thời hết hàng!');}},'json');});}}
return false;}
if(req>1){var colorAt=$('.color a.active'),sizeAt=$('.size a.active');if(colorAt.length&&sizeAt.length){attrs[$('.color').attr('column')]=colorAt.attr('value');attrs[$('.size').attr('column')]=sizeAt.attr('value');$.post('/product/child?psId='+atc.attr('psid'),{'attrs':attrs},function(rs){if(rs.code==1){qtt.attr('max',rs.data.available);atc.attr('selId',rs.data.id).removeAttr('title').attr('ck',1).removeClass('unsel');}else{atc.attr('title','Sản phẩm tạm thời hết hàng!');}},'json');return false;}
if(colorAt.length&&!sizeAt.length){attrs[$('.color').attr('column')]=colorAt.attr('value');$('.size a').each(function(){var t=$(this);attrs[$('.size').attr('column')]=t.attr('value');$.post('/product/child?psId='+atc.attr('psid'),{'attrs':attrs},function(rs){console.log(rs.data);if(rs.code==1){t.attr('qtt',rs.data.available).attr('selId',rs.data.id).attr('data-price',rs.data.price);}else{t.addClass('deactive').attr('title','Sản phẩm tạm thời hết hàng!');}},'json');});return false;}
if(!colorAt.length&&sizeAt.length){attrs[$('.size').attr('column')]=sizeAt.attr('value');$('.color a').each(function(){var t=$(this);attrs[$('.color').attr('column')]=t.attr('value');$.post('/product/child?psId='+atc.attr('psid'),{'attrs':attrs},function(rs){if(rs.code==1){t.attr('qtt',rs.data.available).attr('selId',rs.data.id);}else{t.addClass('deactive').attr('title','Sản phẩm tạm thời hết hàng!');}},'json');});return false;}}}